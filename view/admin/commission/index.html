{% include 'admin/lib/header.html' %}
<body>	
<div class="page-container">	
   <div class="left-content">
	   <div class="mother-grid-inner">
            <!--header start here-->
			{% include 'admin/lib/nav.html' %}
					
			
<!--inner block start here-->
<div class="inner-block">
<!--mainpage chit-chating-->
<div class="chit-chat-layer1">
	<div class="col-md-12 col-sm-12 col-lg-12 chit-chat-layer1-left">
               <div class="work-progres">
                            <div class="chit-chat-heading">
								{{constant('COMMISSION MANAGEMENT')}}   <a href="#" data-toggle="modal" data-target="#myModal" class="hvr-icon-float-away add-latest-user"></a>
							</div>
                            <div class="table-responsive">
                                <table class="table">
									<thead class="thead-inverse table-head-bg">
									<tr>
										<th>{{ constant('COUNTRY')}}</th>
										<th>{{ constant('RESTURANT')}}</th>
										<th>{{ constant('TYPE')}}</th>
										<th>{{ constant('COMMISSION VALUE')}}</th>
										<th>{{ constant('CREATED')}}</th>
										<th>{{ constant('ACTION')}}</th>
									</tr>
									</thead>
									<tbody>	
										{% if results %}
											{% for key,commission in results %} 
												<tr>									
												<td>{{ commission.country_name|e }}</td>
												<td>{{ commission.resturantbrand_name|e }}</td>
												<td>{{ commission.commission_type|e }}</td>
												<td>{{ commission.commission_value|e }}</td>
												<td>{{ commission.commission_created|e }}</td>
												
												<td>
												
												<div class="market-update-right">
											<span><a class="modal-view" href="" data-id="{{ commission.commission_id|e }}" data-toggle="modal" data-target="#myModal-view" title="View Commission History "><i class="fa fa-eye latest-view-icon"></i></a></span>
											<span><a class="modal-edit" href="#" data-toggle="modal" data-id="{{base_url}}admin/commission/edit/{{ commission.commission_id|e }}" data-value="{{ commission.commission_value|e }}" data-type="{{ commission.commission_type|e }}"   data-country="{{ commission.country_name|e }}" data-rest="{{ commission.resturantbrand_name|e }}" data-target="#myModal-edit"><i class="fa fa-edit edit-right"></i></a></span>
										
										</div>
												
												
												</td>
												</tr>
											{% endfor %}
									{% else %}									
									<tr>									
									<td class="record" colspan="4" >
									{{ constant('NO RECORD FOUND')}} </td>								
									</tr>							
									{% endif %}
										
									</tbody>
                                </table>
                                            <!--Pagination -->
            <nav class="my-4 pagenation-border">
              {{ links|raw  }}
                <div class="total-records">
                    <div>{% if results %}
							{{start}}-{{end}} {{ constant('RECORD')}}
							{% else %}
							
							0 {{ constant('RECORD')}}
							{% endif %}</div>
                </div>
            </nav>
            <!--/Pagination -->
                  </div>
             </div>
      </div>

     <div class="clearfix"> </div>
</div>
<!--main page chit chating end here-->

<!--climate end here-->
</div>
<!--inner block end here-->
<!--copy rights start here-->
	{% include 'admin/lib/footer.html' %}	
<!--COPY rights end here-->
</div>
</div>
<!--slider menu-->
    	{% include 'admin/lib/sidebar.html' %}
</div>
<!--slide bar menu end here-->

<!--Add country add-->

<div class="modal fade" id="myModal" role="dialog">
		<div class="modal-dialog">
		
		  <!-- Modal content-->
		  <div class="modal-content">
			<div class="modal-header">
			  <button type="button" class="close" data-dismiss="modal">&times;</button>
			  <h4 class="modal-title">{{constant('ADD')}} {{constant('COMMISSION MANAGEMENT')}}</h4>
			</div>
			<div class="col-md-12">
					<div class="card form-white" style="box-shadow: none;">
							<div class="card" style="box-shadow:none">
									<div class="card-body">
										<!-- Form contact -->
										<form action="{{ base_url }}admin/commission/add" method="POST" name="commission_form">
										
										<div class="col-md-12 md-form" style="padding:0px;">
											<i class="fa fa-globe prefix grey-text"></i>
											<label for="form31">{{constant('COUNTRY')}}</label>
											<select id="country_rel" name="commission_country_id" class="selectpicker form-control-select">
											<option value="">{{ constant('PLEASE SELECT') }}</option>
											{% if related_country %}
												{% for key,country in related_country %} 
													{% if country.country_status == 1 %}
														<option value="{{ country.country_code|e}}">{{ country.country_name|e }}</option>
													{% endif %}
												{% endfor %}
											{% endif %}
											</select>				
										</div>
									 	<div class="col-md-12 md-form" style="padding:0px;">
											<i class="fa fa-500px prefix grey-text"></i>
											<label for="commission_brand_id">{{constant('RESTURANT')}}</label>
											 <select name="commission_brand_id[]" class="selectpicker form-control-select"  id="commission_brand_id"  multiple>
				                                <option value="">{{ constant('PLEASE SELECT')}}</option>
												{% set selector = '' %}
												
												{% for key, resturant_branch in resturants %} 
												
												 {% if (resturant_branch.resturantbrand_id) == set_data.resturantbrand_type %}
													   <option value="{{resturant_branch.resturantbrand_id}}" selected
														>{{resturant_branch.resturantbrand_name}}</option>
																	{% else %}
								                                <option value="{{resturant_branch.resturantbrand_id}}" 
														>{{resturant_branch.resturantbrand_name}}</option>
														{% endif %}
																{% endfor %}
								                                
								                            </select>
															NOTE*: Select with CTRL.
										</div>	
										<div class="col-md-12 md-form" style="padding:0px;">
											<i class="fa fa-reorder prefix grey-text"></i>
											<label for="commission_type">{{ constant('TYPE')}}<span class="required">*</span></label>
											<select id="commission_type" name="commission_type" class="selectpicker form-control-select">
												<option value="">{{constant('PLEASE SELECT')}}</option>										
												<option value="fixed">Fixed</option>										
												<option value="percentage">Percentage</option>										
											</select>				
										</div>	
								
										<div class="col-md-12 md-form" style="padding:0px;">
											<i class="fa fa-hand-grab-o prefix grey-text"></i>
											<label for="commission_value">{{constant('COMMISSION VALUE')}}<span class="required">*</span></label>
											<input type="text" id="commission_value" min="1" name="commission_value" class="form-control" placeholder="{{constant('COMMISSION VALUE')}} ">												
										</div>								
											<div class="col-md-12 text-center">
												<button class="btn btn-success">{{constant('SUBMIT')}}</button>
												<button class="btn btn-default" data-dismiss="modal">{{constant('CANCEL')}}</button>
											</div>
										</form>
										<!-- Form contact -->
									</div>
								</div>
						</div>
			</div>
			
				
				</form>
			<div class="modal-footer">
			  <!--<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>-->
			</div>
		  </div>
		  
		</div>
	  </div>

<!--Add country add-->

<!--edit country add-->

<div class="modal fade" id="myModal-edit" role="dialog">
		<div class="modal-dialog">
		
		  <!-- Modal content-->
		  <div class="modal-content">
			<div class="modal-header">
			  <button type="button" class="close" data-dismiss="modal">&times;</button>
			  <h4 class="modal-title">{{constant('EDIT')}} {{constant('COMMISSION MANAGEMENT')}}</h4>
			</div>
			<div class="col-md-12">
					<div class="card form-white" style="box-shadow: none;">
							<div class="card" style="box-shadow:none">
									<div class="card-body">
										<!-- Form contact -->
										<form action="" id="edit_country_form" name="edit_country_form" method="POST">
										
										<div class="col-md-12 md-form" style="padding:0px;">
									<i class="fa fa-globe prefix grey-text"></i>
									<label for="commission_country_id">{{constant('COUNTRY')}}</label>
									<input type="text" id="commission_country_id1"  name="commission_country_id" class="form-control"  readonly value="" placeholder="{{constant('COUNTRY')}} ">			
								</div>
									<div class="col-md-12 md-form" style="padding:0px;">
									<i class="fa fa-500px prefix grey-text"></i>
									<label for="commission_brand_id">{{constant('RESTURANT')}}</label>
														 <input type="text" id="commission_brand_id1"  name="commission_brand_id" class="form-control" readonly value="" placeholder="{{constant('RESTURANT')}} ">		
								</div>
							
									<div class="col-md-12 md-form" style="padding:0px;">
										<i class="fa fa-reorder prefix grey-text"></i>
										<label for="commission_type">{{ constant('TYPE')}}<span class="required">*</span></label>
										<select id="commission_type1" name="commission_type" class="selectpicker form-control-select">
											<option value="">{{constant('PLEASE SELECT')}}</option>										
											<option value="fixed">Fixed</option>										
											<option value="percentage">Percentage</option>										
										</select>				
									</div>	
								
								<div class="col-md-12 md-form" style="padding:0px;">
									<i class="fa fa-hand-grab-o prefix grey-text"></i>
									<label for="commission_value">{{constant('COMMISSION VALUE')}}<span class="required">*</span></label>
									<input type="text" id="commission_value1" min="1" name="commission_value" class="form-control" placeholder="{{constant('COMMISSION VALUE')}} ">												
								</div>				
											<div class="col-md-12 text-center">
												<button class="btn btn-success">{{constant('SUBMIT')}}</button>
												<button  class="btn btn-default" data-dismiss="modal">{{constant('CANCEL')}}</button>
											</div>
										</form>
										<!-- Form contact -->
									</div>
								</div>
						</div>
			</div>
			
				
				</form>
			<div class="modal-footer">
			  <!--<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>-->
			</div>
		  </div>
		  
		</div>
	  </div>

<!--edit department add-->
   <!----modal starts here --->
<div id="deleteModal" class="modal fade" role='dialog'>
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                <h4 class="modal-title">{{constant('DELETE')}} </h4>
            </div>
            <div class="modal-body">
                <p>Do You Really Want to Delete This ?</p>
                
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">{{constant('CANCEL')}}</button>
				<span id= 'deleteButton'></span>
            </div>
			
        </div>
      </div>
  </div>
<!--Modal ends here--->

<!--View Discount Coupon-->
<div class="modal fade" id="myModal-view" role="dialog">
		<div class="modal-dialog">		
		  <!-- Modal content-->
		  <div class="modal-content">
			<div class="modal-header">
			  <button type="button" class="close" data-dismiss="modal">&times;</button>
			  <h4 class="modal-title">{{constant('HISTORY')}}
			  {{ constant('COMMISSION MANAGEMENT')}}</h4>
			</div>
			<div class="col-md-12">
				<div class="card form-white" style="box-shadow: none;">
					<div class="card" style="box-shadow:none">
						<div class="card-body" id="commission_view">
							
						</div>
					</div>
				</div>
			</div>
			<div class="modal-footer">
			  <!--<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>-->
			</div>
		</div>		  
	</div>
</div>
<!--View discount coupon-->

<script>
var toggle = true;
            
$(".sidebar-icon").click(function() {                
  if (toggle)
  {
    $(".page-container").addClass("sidebar-collapsed").removeClass("sidebar-collapsed-back");
    $("#menu span").css({"position":"absolute"});
  }
  else
  {
    $(".page-container").removeClass("sidebar-collapsed").addClass("sidebar-collapsed-back");
    setTimeout(function() {
      $("#menu span").css({"position":"relative"});
    }, 400);
  }               
                toggle = !toggle;
            });
</script>
<!--scrolling js-->
		<script src="{{base_url}}assets/js/jquery.nicescroll.js"></script>
		<script src="{{base_url}}assets/js/scripts.js"></script>
		<!--//scrolling js-->
<script src="{{base_url}}assets/js/bootstrap.js"> </script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mdbootstrap/4.4.1/js/mdb.min.js"></script>

<script type="text/javascript">
$(document).ready(function(){	
	$('.add-latest-user').click(function(e){
		e.preventDefault();
		$('label.error').css('display','none');
		$('.form-control').removeClass('error');
		$('select').removeClass('error');
		$('form[name="commission_form"]')[0].reset();
	});
});
	// Wait for the DOM to be ready
$(function() {
  // Initialize form validation on the registration form.
  // It has the name attribute "registration"
  $("form[name='commission_form']").validate({
    rules: {
      // The key name on the left side is the name attribute
      // of an input field. Validation rules are defined
      // on the right side
		commission_country_id: "required",
		'commission_brand_id[]': "required",
		commission_type:{
		required: true,
		},
		commission_value:{
		required: true,
		number: true
		},
	 },
    // Specify validation error messages
    messages: {
     commission_country_id: "Please Select Country Name.",
		'commission_brand_id[]':  "Please Select Restaurant Brand Name.",
		commission_type:{
						required: "Please Select value type.",
						},
		commission_value:{
						required: "Please enter minimum charges.",
						number: "Please enter numeric value."
						},

    },
    submitHandler: function(form) {
	     var formData = $(form).serialize();
		 var urlData = $(form).attr('action');
		 $.ajax(
			{
				url : urlData,
				type: "POST",
				crossDomain: true,
				data : formData,
				success:function(data) 
				{
				  var data = $.parseJSON(data);
					if(data.error == 'true'){
					   $.each(data.error_msg, function( index, value ) {
					   $('#'+index).after('<label id="'+index+'-error" class="error" for="user_name">'+value+'</label>');
                       });
					   
					}else{
					$('form[name="commission_form"]')[0].reset();
					$('form[name="commission_form"]').before('<div class="alert alert-success alert-dismissable"><button aria-hidden="true" data-dismiss="alert" class="close" type="button"> × </button>'+data.success_message+'</div>');
					if($('.alert').delay(10000).fadeOut(100)){
					window.location.reload();
					}
				    
            		}
				}
			});
    }
  });
});


</script>

 <script language="javascript">
    $(".modal-edit").click(function(e) {  
	e.preventDefault();
	  	$('label.error').css('display','none');
		$('.form-control').removeClass('error');
		$('select').removeClass('error');
		$('form[name="edit_country_form"]')[0].reset();
	    $('#commission_brand_id1').attr('value',$(this).data('rest'));
		$('#commission_country_id1').attr('value',$(this).data('country'));
        $('#commission_value1').attr('value',$(this).data('value'));			
		$('#edit_country_form').attr('action',$(this).data('id'));
		$('select#commission_type1').find('option[value="'+$(this).data('type')+'"]').prop("selected", true);			
     });
    </script>

<script type="text/javascript">

	// Wait for the DOM to be ready
$(function() {
  // Initialize form validation on the registration form.
  // It has the name attribute "registration"
  $("form[name='edit_country_form']").validate({
    // Specify validation rules
         rules: {
      // The key name on the left side is the name attribute
      // of an input field. Validation rules are defined
      // on the right side
		
		commission_value:{
		required: true,
		number: true
		},
		commission_type:{
		required: true,
		},
	 },
    // Specify validation error messages
    messages: {
    
		commission_value:{
						required: "Please enter commission value.",
						number: "Please enter numeric value."
						},
		commission_type:{
						required: "Please Select Type.",
						},

    },
    // Make sure the form is submitted to the destination defined
    // in the "action" attribute of the form when valid
    submitHandler: function(form) {
	     var formData = $(form).serialize();
		 var urlData = $(form).attr('action');
		 $.ajax(
			{
				url : urlData,
				type: "POST",
				crossDomain: true,
				data : formData,
				success:function(data) 
				{
				  var data = $.parseJSON(data);
				  
					if(data.error == 'true'){
					   $.each(data.error_msg, function( index, value ) {
						$('#'+index).after('<label id="'+index+'-error" class="error" for="user_name">'+value+'</label>');
                       });
					   
					}else{
					
					$('form[name="edit_country_form"]')[0].reset();
					$('form[name="edit_country_form"]').before('<div class="alert alert-success alert-dismissable"><button aria-hidden="true" data-dismiss="alert" class="close" type="button"> × </button>'+data.success_message+'</div>');
					if($('.alert').delay(5000).fadeOut(100)){
					window.location.reload();
					}
				    
            		}
				}
			});
    }
  });
});


</script>

<script type="text/javascript">

function confirmDeleteModal(id){
    $('#deleteModal').modal();
	$('#deleteButton').html('<a class="btn btn-danger" onclick="deleteData('+id+')">Delete</a>');
}     
function deleteData(id){
  // do your stuffs with id
  $("#successMessage").html("Record Deleted successfully!");
  var urlData='{{ base_url }}admin/commission/delete/'+id;
   $.ajax(
			{
				url : urlData,
				type: "POST",
			    success:function() 
				{
				$('#deleteModal').modal('hide'); // now close modal
				window.location.reload();
				}
			});
			
  
}  
$(document).on('change','#country_rel',function(){
var id=$(this).val();
  $.ajax(
			{
				url :"{{base_url}}admin/commission/select_resturant/"+id,
				type: "POST",
			    success:function(data) 
				{
				 var data = $.parseJSON(data);
				 var datahtml="";
					$.each(data, function( index, value ) {
					datahtml+='<option value="'+value['resturantbrand_id']+'">'+value['resturantbrand_name']+'</option>';
                     });
				$('#commission_brand_id').html(datahtml); // now close modal
				
				}
			});
});
	$(".modal-view").click(function(e) {  
		e.preventDefault();
		var cid = $(this).data('id');
		var urlData='{{ base_url }}admin/commission/view/'+cid;
			$.ajax(
				{
					url : urlData,
					type: "POST",
					crossDomain: true,
					success:function(data) 
					{
						var data = $.parseJSON(data);	
                        var datahtml="";
                        if(data){						
                       	datahtml+='<table class="table"><thead class="thead-inverse table-head-bg"><tr><th>{{constant("COUNTRY")}}</th><th>{{constant("RESTURANT")}}</th>									<th>{{constant("TYPE")}}</th><th>{{constant("COMMISSION VALUE")}}</th><th>{{constant("CREATED")}}</th></tr></thead>	<tbody>';					
						   $.each(data, function( key, value ) {
							datahtml+='<tr><td>'+value['country_name']+'</td><td>'+value['resturantbrand_name']+'</td><td>'+value['commission_type']+'</td><td>'+value['commission_value']+'</td><td>'+value['commission_created']+'</td></tr>';
						   });		
						   datahtml+=" </tbody> </table>";
						   }
$('#commission_view').html(datahtml);						   
					}
				});							
        });
</script>
</body>
</html>                     